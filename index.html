<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nexuscommerce - Secure Credentials</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f7f7f7;
      color: #333;
      line-height: 1.6;
    }
    .container {
      max-width: 550px;
      margin: 40px auto;
      padding: 0;
    }
    .nx-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    .nx-header {
      padding: 24px;
      background: #f9f9f9;
      border-bottom: 1px solid #eee;
    }
    .nx-header-title {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .nx-platform-badge {
      background: #22c55e;
      color: white;
      font-size: 12px;
      font-weight: 500;
      padding: 4px 8px;
      border-radius: 4px;
      margin-left: 10px;
    }
    .nx-future-platforms {
      font-size: 12px;
      color: #64748b;
      margin-top: 5px;
      display: flex;
      align-items: center;
    }
    .nx-future-platforms svg {
      margin-right: 5px;
    }
    .nx-body {
      padding: 24px;
    }
    .nx-form-group {
      margin-bottom: 20px;
      position: relative;
    }
    .nx-label {
      display: flex;
      align-items: center;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    .nx-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
      transition: border-color 0.2s ease;
    }
    .nx-input:focus {
      outline: none;
      border-color: #22c55e;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.1);
    }
    .nx-alert {
      padding: 16px;
      background: #fffbeb;
      border: 1px solid #fef3c7;
      border-radius: 6px;
      margin-bottom: 20px;
      display: flex;
      align-items: flex-start;
    }
    .nx-alert-icon {
      margin-right: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    .nx-alert-text {
      font-size: 14px;
      color: #92400e;
    }
    .nx-radio-group {
      margin-bottom: 20px;
    }
    .nx-radio-option {
      display: flex;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    .nx-radio {
      margin-right: 10px;
      margin-top: 3px;
    }
    .nx-radio-label {
      font-size: 14px;
      font-weight: 500;
    }
    .nx-checkbox-group {
      display: flex;
      margin: 24px 0;
    }
    .nx-checkbox {
      margin-right: 10px;
      margin-top: 3px;
    }
    .nx-btn {
      width: 100%;
      padding: 12px 16px;
      background: #22c55e;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    .nx-btn:hover {
      background: #16a34a;
    }
    .nx-btn:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.3);
    }
    .nx-success {
      margin-top: 20px;
      padding: 16px;
      background: #dcfce7;
      border: 1px solid #86efac;
      border-radius: 6px;
      display: flex;
      align-items: flex-start;
    }
    .nx-success-icon {
      margin-right: 12px;
      flex-shrink: 0;
      margin-top: 2px;
    }
    .nx-success-text {
      font-size: 14px;
      color: #166534;
    }
    .help-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #e2e8f0;
      color: #64748b;
      font-size: 10px;
      font-weight: bold;
      margin-left: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .help-icon:hover {
      background: #cbd5e1;
    }
    .tooltip-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 5;
    }
    .tooltip {
      position: absolute;
      z-index: 10;
      width: 320px;
      max-height: 380px;
      overflow-y: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      padding: 16px;
      font-size: 13px;
      color: #475569;
      display: none;
      border: 1px solid #e2e8f0;
    }
    .tooltip.visible {
      display: block;
    }
    /* Position tooltips more strategically */
    .store-url-help .tooltip {
      top: 100%;
      left: 0;
      margin-top: 8px;
    }
    .api-key-help .tooltip,
    .api-password-help .tooltip {
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      position: fixed;
    }
    .email-help .tooltip {
      top: 100%;
      right: 0;
      margin-top: 8px;
    }
    .tooltip-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: #22c55e;
      font-size: 15px;
      padding-right: 20px;
    }
    .tooltip-steps {
      margin: 0;
      padding-left: 18px;
    }
    .tooltip-steps li {
      margin-bottom: 8px;
    }
    .tooltip-steps li:last-child {
      margin-bottom: 0;
    }
    .tooltip-support {
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid #e2e8f0;
      font-size: 12px;
      color: #64748b;
    }
    .tooltip-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: #f1f5f9;
      border: none;
      cursor: pointer;
      color: #64748b;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.2s ease;
    }
    .tooltip-close:hover {
      background: #e2e8f0;
      color: #475569;
    }
    /* Responsive adjustment */
    @media (max-width: 600px) {
      .container {
        margin: 20px auto;
        padding: 0 20px;
      }
      .tooltip {
        width: 280px;
        max-width: 90vw;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="nx-container">
      <!-- Header -->
      <div class="nx-header">
        <div class="nx-header-title">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:10px;">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <h2 style="margin:0;font-size:20px;">Provide Access to Your Store</h2>
          <div class="nx-platform-badge">Shopify</div>
        </div>
        <p style="margin:5px 0 0;font-size:14px;color:#666;">Your credentials are encrypted and securely stored using industry best practices.</p>
        <div class="nx-future-platforms">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
          Salesforce Commerce Cloud, BigCommerce, Adobe Commerce, and other enterprise platforms coming soon
        </div>
      </div>
      
      <!-- Form Body -->
      <div class="nx-body">
        <!-- Shopify Form -->
        <div id="shopify-form">
          <div class="nx-alert">
            <span class="nx-alert-icon">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
            </span>
            <span class="nx-alert-text">
              Nexuscommerce uses your credentials to securely access your Shopify store data for analysis and optimization. 
              We recommend using dedicated API credentials rather than your admin login.
            </span>
          </div>
          
          <!-- Credential Type Selection -->
          <div class="nx-radio-group">
            <div class="nx-radio-option">
              <input type="radio" id="shopify-api" name="shopify-auth-type" class="nx-radio" value="api" checked>
              <label for="shopify-api" class="nx-radio-label">Use API credentials (recommended)</label>
            </div>
            <div class="nx-radio-option">
              <input type="radio" id="shopify-admin" name="shopify-auth-type" class="nx-radio" value="admin">
              <label for="shopify-admin" class="nx-radio-label">Use admin login (optional for our team to assist you with site edits)</label>
            </div>
          </div>
          
          <div class="nx-form-group store-url-help">
            <label class="nx-label">
              Store URL
              <div class="help-icon" data-tooltip="shopify-url-tooltip">?</div>
            </label>
            <input type="text" id="shopify-url" class="nx-input" placeholder="yourstore.myshopify.com">
            <div id="shopify-url-tooltip" class="tooltip">
              <div class="tooltip-title">Finding Your Shopify Store URL</div>
              <button class="tooltip-close">✕</button>
              <ol class="tooltip-steps">
                <li>Your store URL is your Shopify domain</li>
                <li>It typically follows the format: <strong>yourstore.myshopify.com</strong></li>
                <li>You can find this in your browser address bar when logged into your Shopify admin</li>
              </ol>
              <div class="tooltip-support">
                If you need additional assistance, send us a message in your NexusCommerce portal or email us at contact@nexuscommerce.co.
              </div>
            </div>
          </div>
          
          <!-- API credentials fields -->
          <div id="shopify-api-fields">
            <div class="nx-form-group api-key-help">
              <label class="nx-label">
                API Key
                <div class="help-icon" data-tooltip="shopify-key-tooltip">?</div>
              </label>
              <input type="text" id="shopify-key" class="nx-input">
              <div id="shopify-key-tooltip" class="tooltip">
                <div class="tooltip-title">Finding Your Shopify API Key</div>
                <button class="tooltip-close">✕</button>
                <ol class="tooltip-steps">
                  <li>Log in to your Shopify admin</li>
                  <li>Go to <strong>Settings</strong> > <strong>Apps and sales channels</strong></li>
                  <li>Click <strong>Develop apps</strong> > <strong>Create an app</strong></li>
                  <li>Give your app a name (e.g. "Nexuscommerce")</li>
                  <li>From the app overview page, click <strong>Configure Admin API scopes</strong></li>
                  <li>Select the necessary read permissions and Save</li>
                  <li>Go back to the app overview and click <strong>Install app</strong></li>
                  <li>After installation, you'll see your API key and API secret key</li>
                </ol>
                <div class="tooltip-support">
                  If you need additional assistance, send us a message in your NexusCommerce portal or email us at contact@nexuscommerce.co.
                </div>
              </div>
            </div>
            
            <div class="nx-form-group api-password-help">
              <label class="nx-label">
                API Password
                <div class="help-icon" data-tooltip="shopify-password-tooltip">?</div>
              </label>
              <input type="password" id="shopify-password" class="nx-input">
              <div id="shopify-password-tooltip" class="tooltip">
                <div class="tooltip-title">Finding Your API Password</div>
                <button class="tooltip-close">✕</button>
                <ol class="tooltip-steps">
                  <li>This is also called your "API secret key" or "Admin API access token"</li>
                  <li>You can find it in the same location as your API key</li>
                  <li>For security, Shopify only shows this once when you create your API credentials</li>
                  <li>If you've lost it, you'll need to regenerate a new API password</li>
                </ol>
                <div class="tooltip-support">
                  If you need additional assistance, send us a message in your NexusCommerce portal or email us at contact@nexuscommerce.co.
                </div>
              </div>
            </div>
          </div>
          
          <!-- Admin login fields -->
          <div id="shopify-admin-fields" style="display:none;">
            <div class="nx-form-group email-help">
              <label class="nx-label">
                Email Address
                <div class="help-icon" data-tooltip="shopify-email-tooltip">?</div>
              </label>
              <input type="email" id="shopify-email" class="nx-input">
              <div id="shopify-email-tooltip" class="tooltip">
                <div class="tooltip-title">Shopify Admin Email</div>
                <button class="tooltip-close">✕</button>
                <p>Enter the email address you use to log in to your Shopify admin dashboard.</p>
                <p><strong>Note:</strong> Providing admin login is optional and only needed if you'd like our team to assist with store customizations or content updates.</p>
                <div class="tooltip-support">
                  If you need additional assistance, send us a message in your NexusCommerce portal or email us at contact@nexuscommerce.co.
                </div>
              </div>
            </div>
            
            <div class="nx-form-group">
              <label class="nx-label">Password</label>
              <input type="password" id="shopify-admin-password" class="nx-input">
            </div>
          </div>
        </div>
        
        <!-- Common Form Elements -->
        <div class="nx-checkbox-group">
          <input type="checkbox" id="terms" class="nx-checkbox">
          <div>
            <label for="terms" style="font-size:14px;font-weight:500;">I understand that:</label>
            <p style="margin:2px 0 0;font-size:14px;color:#666;">Nexuscommerce will securely store these credentials to provide analytics, reporting, and optimization services.</p>
          </div>
        </div>
        
        <button id="submit-btn" class="nx-btn">Securely Store Credentials</button>
        
        <!-- Success Message (hidden by default) -->
        <div id="success-message" class="nx-success" style="display:none;">
          <span class="nx-success-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </span>
          <span id="success-text" class="nx-success-text"></span>
        </div>
        
        <!-- Return Link (hidden initially) -->
        <div id="return-link" style="text-align:center; margin-top:20px; display:none;">
          <a href="#" id="return-to-nexus" style="color:#22c55e; text-decoration:none; font-weight:500;">Return to Nexuscommerce</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Tooltip overlay for dimming background -->
  <div class="tooltip-overlay" id="tooltip-overlay"></div>

  <script>
    // Toggle between API and admin login fields
    document.querySelectorAll('input[name="shopify-auth-type"]').forEach(radio => {
      radio.addEventListener('change', function() {
        toggleAuthFields();
        closeAllTooltips();
      });
    });
    
    function toggleAuthFields() {
      const authType = document.querySelector('input[name="shopify-auth-type"]:checked').value;
      
      document.getElementById('shopify-api-fields').style.display = authType === 'api' ? 'block' : 'none';
      document.getElementById('shopify-admin-fields').style.display = authType === 'admin' ? 'block' : 'none';
    }
    
    // Help tooltips functionality
    const helpIcons = document.querySelectorAll('.help-icon');
    const tooltipOverlay = document.getElementById('tooltip-overlay');
    let activeTooltip = null;
    
    // Initialize tooltip events
    helpIcons.forEach(icon => {
      const tooltipId = icon.getAttribute('data-tooltip');
      const tooltip = document.getElementById(tooltipId);
      
      // Add click event to show tooltip
      icon.addEventListener('click', function(event) {
        event.stopPropagation();
        
        // Close any other open tooltips first
        closeAllTooltips();
        
        // Show this tooltip
        tooltip.classList.add('visible');
        tooltipOverlay.style.display = 'block';
        activeTooltip = tooltip;
      });
      
      // Add close button functionality
      if (tooltip) {
        const closeBtn = tooltip.querySelector('.tooltip-close');
        if (closeBtn) {
          closeBtn.addEventListener('click', function(event) {
            event.stopPropagation();
            closeTooltip(tooltip);
          });
        }
      }
    });
    
    // Close when clicking overlay
    tooltipOverlay.addEventListener('click', function() {
      closeAllTooltips();
    });
    
    // Close when pressing Escape key
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        closeAllTooltips();
      }
    });
    
    // Helper functions for tooltips
    function closeTooltip(tooltip) {
      tooltip.classList.remove('visible');
      tooltipOverlay.style.display = 'none';
      activeTooltip = null;
    }
    
    function closeAllTooltips() {
      document.querySelectorAll('.tooltip').forEach(tooltip => {
        tooltip.classList.remove('visible');
      });
      tooltipOverlay.style.display = 'none';
      activeTooltip = null;
    }
    
    // Get URL parameters
    function getUrlParams() {
      const params = {};
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      
      // Get customer ID and return URL
      params.customerId = urlParams.get('customerId') || 'unknown';
      params.returnUrl = urlParams.get('returnUrl') || null;
      
      return params;
    }
    
    // Set up return link if provided
    const params = getUrlParams();
    if (params.returnUrl) {
      document.getElementById("return-to-nexus").href = decodeURIComponent(params.returnUrl);
    }
    
    // Handle form submission
    document.getElementById("submit-btn").addEventListener("click", function() {
      // Get auth type
      let authType = document.querySelector('input[name="shopify-auth-type"]:checked').value;
      
      // Show loading state
      const button = document.getElementById("submit-btn");
      const originalText = button.textContent;
      button.textContent = "Securely Storing...";
      button.disabled = true;
      
      // Build credentials object based on auth type
      let credentials = {};
      let storeUrl = document.getElementById("shopify-url").value;
      
      if (authType === 'api') {
        credentials = {
          type: 'api',
          apiKey: document.getElementById("shopify-key").value,
          apiSecret: document.getElementById("shopify-password").value
        };
      } else { // admin login
        credentials = {
          type: 'admin',
          email: document.getElementById("shopify-email").value,
          password: document.getElementById("shopify-admin-password").value
        };
      }
      
      // Simulated API call
      setTimeout(function() {
        // Show success message
        document.getElementById("success-text").textContent = 
          "Your Shopify credentials have been securely stored.";
        document.getElementById("success-message").style.display = "flex";
        
        // Reset button
        button.textContent = originalText;
        button.disabled = false;
        
        // Clear sensitive fields
        if (authType === 'api') {
          document.getElementById("shopify-key").value = "";
          document.getElementById("shopify-password").value = "";
        } else {
          document.getElementById("shopify-email").value = "";
          document.getElementById("shopify-admin-password").value = "";
        }
        
        // Show return link
        document.getElementById("return-link").style.display = "block";
        
        // In production, send data to API
        fetch('https://2qqns62uhf.execute-api.us-east-2.amazonaws.com/Deploy/credentials', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            customerId: params.customerId,
            platform: 'shopify',
            storeUrl: storeUrl,
            credentials: credentials
          })
        }).then(response => {
          if (!response.ok) throw new Error('Failed to store credentials');
          return response.json();
        }).then(data => {
          // Success handling
          document.getElementById("success-text").textContent = 
            "Your Shopify credentials have been securely stored.";
          document.getElementById("success-message").style.display = "flex";
          document.getElementById("return-link").style.display = "block";
        }).catch(error => {
          // Error handling
          console.error('Error:', error);
          alert("Error storing credentials: " + error.message);
        });
        
      }, 1500);
    });
  </script>
</body>
</html>
